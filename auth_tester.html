<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Auth Tester</title>
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
            rel="stylesheet"
        />
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
            body {
                font-family: "Inter", sans-serif;
            }
        </style>
    </head>
    <body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-lg w-full">
            <!-- Status Message Box -->
            <div
                id="status-message"
                class="hidden mb-4 p-4 rounded-lg text-center"
                role="alert"
            ></div>

            <!-- Authentication Forms -->
            <div id="auth-forms">
                <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">
                    Authentication Tester
                </h1>

                <!-- Sign Up Form -->
                <div id="signup-form" class="transition-opacity duration-300">
                    <h2
                        class="text-2xl font-semibold text-gray-700 mb-4 text-center"
                    >
                        Sign Up
                    </h2>
                    <form id="signup-submit">
                        <div class="mb-4">
                            <label
                                for="signup-username"
                                class="block text-gray-600 font-medium"
                                >Username</label
                            >
                            <input
                                type="text"
                                id="signup-username"
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 transition-colors duration-200 p-2"
                                required
                            />
                        </div>
                        <div class="mb-4">
                            <label
                                for="signup-email"
                                class="block text-gray-600 font-medium"
                                >Email</label
                            >
                            <input
                                type="email"
                                id="signup-email"
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 transition-colors duration-200 p-2"
                                required
                            />
                        </div>
                        <div class="mb-6">
                            <label
                                for="signup-password"
                                class="block text-gray-600 font-medium"
                                >Password</label
                            >
                            <input
                                type="password"
                                id="signup-password"
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 transition-colors duration-200 p-2"
                                required
                            />
                        </div>
                        <button
                            type="submit"
                            class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-700 transition-colors duration-200"
                        >
                            Sign Up
                        </button>
                    </form>
                    <p class="text-center mt-4 text-gray-600">
                        Already have an account?
                        <button
                            id="show-login"
                            class="text-blue-600 hover:text-blue-800 font-medium"
                        >
                            Log in
                        </button>
                    </p>
                </div>

                <!-- Login Form -->
                <div
                    id="login-form"
                    class="hidden transition-opacity duration-300"
                >
                    <h2
                        class="text-2xl font-semibold text-gray-700 mb-4 text-center"
                    >
                        Log In
                    </h2>
                    <form id="login-submit">
                        <div class="mb-4">
                            <label
                                for="login-email"
                                class="block text-gray-600 font-medium"
                                >Email</label
                            >
                            <input
                                type="email"
                                id="login-email"
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 transition-colors duration-200 p-2"
                                required
                            />
                        </div>
                        <div class="mb-6">
                            <label
                                for="login-password"
                                class="block text-gray-600 font-medium"
                                >Password</label
                            >
                            <input
                                type="password"
                                id="login-password"
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 transition-colors duration-200 p-2"
                                required
                            />
                        </div>
                        <button
                            type="submit"
                            class="w-full bg-green-600 text-white font-bold py-2 px-4 rounded-md hover:bg-green-700 transition-colors duration-200"
                        >
                            Log In
                        </button>
                    </form>
                    <p class="text-center mt-4 text-gray-600">
                        Don't have an account?
                        <button
                            id="show-signup"
                            class="text-green-600 hover:text-green-800 font-medium"
                        >
                            Sign up
                        </button>
                    </p>
                </div>
            </div>

            <!-- Verification Status -->
            <div
                id="verification-status"
                class="hidden text-center transition-opacity duration-300"
            >
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">
                    Email Verification
                </h2>
                <p id="verification-message" class="text-lg text-gray-600"></p>
            </div>
        </div>

        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const BASE_URL = "http://localhost:3030/api";
                const signupForm = document.getElementById("signup-form");
                const loginForm = document.getElementById("login-form");
                const showLoginBtn = document.getElementById("show-login");
                const showSignupBtn = document.getElementById("show-signup");
                const signupSubmitBtn =
                    document.getElementById("signup-submit");
                const loginSubmitBtn = document.getElementById("login-submit");
                const verificationStatusDiv = document.getElementById(
                    "verification-status"
                );
                const statusMessageDiv =
                    document.getElementById("status-message");

                const showSection = (sectionId) => {
                    signupForm.classList.add("hidden");
                    loginForm.classList.add("hidden");
                    verificationStatusDiv.classList.add("hidden");
                    document
                        .getElementById(sectionId)
                        .classList.remove("hidden");
                };

                const displayMessage = (message, type) => {
                    statusMessageDiv.textContent = message;
                    statusMessageDiv.classList.remove(
                        "hidden",
                        "bg-red-200",
                        "text-red-800",
                        "bg-green-200",
                        "text-green-800"
                    );
                    if (type === "success") {
                        statusMessageDiv.classList.add(
                            "bg-green-200",
                            "text-green-800"
                        );
                    } else if (type === "error") {
                        statusMessageDiv.classList.add(
                            "bg-red-200",
                            "text-red-800"
                        );
                    }
                };

                // Handle verification on page load
                const urlParams = new URLSearchParams(window.location.search);
                const token = urlParams.get("token");
                const id = urlParams.get("id");

                if (token && id) {
                    showSection("verification-status");
                    document
                        .getElementById("auth-forms")
                        .classList.add("hidden");
                    document.getElementById(
                        "verification-message"
                    ).textContent = "Verifying your email...";

                    fetch(
                        `${BASE_URL}/auth/verify-email?token=${token}&id=${id}`
                    )
                        .then((response) => response.json())
                        .then((data) => {
                            if (data.status === 200) {
                                document.getElementById(
                                    "verification-message"
                                ).textContent = data.message;
                                displayMessage(
                                    "Verification successful! You can now log in.",
                                    "success"
                                );
                            } else {
                                document.getElementById(
                                    "verification-message"
                                ).textContent = data.message;
                                displayMessage(
                                    `Error: ${data.message}`,
                                    "error"
                                );
                            }
                        })
                        .catch((err) => {
                            console.error("Verification failed:", err);
                            document.getElementById(
                                "verification-message"
                            ).textContent =
                                "An error occurred during verification. Please try again later.";
                            displayMessage("Network error occurred.", "error");
                        });
                } else {
                    // Show the signup form by default
                    showSection("signup-form");
                }

                // Event Listeners for Forms
                signupSubmitBtn.addEventListener("submit", async (e) => {
                    e.preventDefault();
                    const username =
                        document.getElementById("signup-username").value;
                    const email = document.getElementById("signup-email").value;
                    const password =
                        document.getElementById("signup-password").value;

                    try {
                        const response = await fetch(
                            `${BASE_URL}/auth/signup`,
                            {
                                method: "POST",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify({
                                    username,
                                    email,
                                    password,
                                }),
                            }
                        );
                        const data = await response.json();
                        if (data.status === 201) {
                            displayMessage(data.message, "success");
                        } else {
                            displayMessage(data.message, "error");
                        }
                    } catch (err) {
                        console.error("Signup failed:", err);
                        displayMessage(
                            "An error occurred during sign up.",
                            "error"
                        );
                    }
                });

                loginSubmitBtn.addEventListener("submit", async (e) => {
                    e.preventDefault();
                    const email = document.getElementById("login-email").value;
                    const password =
                        document.getElementById("login-password").value;

                    try {
                        const response = await fetch(`${BASE_URL}/auth/login`, {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ email, password }),
                        });
                        const data = await response.json();
                        if (data.status === 200) {
                            displayMessage(data.message, "success");
                            // In a real app, you would handle the tokens and redirect the user here.
                        } else {
                            displayMessage(data.message, "error");
                        }
                    } catch (err) {
                        console.error("Login failed:", err);
                        displayMessage(
                            "An error occurred during login.",
                            "error"
                        );
                    }
                });

                // Event Listeners for switching forms
                showLoginBtn.addEventListener("click", () => {
                    showSection("login-form");
                });
                showSignupBtn.addEventListener("click", () => {
                    showSection("signup-form");
                });
            });
        </script>
    </body>
</html>
